<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EpiAccess.org - Equitable Epinephrine Access for All New Yorkers</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #1A237E;
            --accent: #FF7043;
            --neutral-light: #FAFAFA;
            --neutral-dark: #212121;
            --community: #4CAF50;
            --comply: #5C6BC0;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--neutral-dark);
            background-color: var(--neutral-light);
            overflow-x: hidden;
        }

        h1, h2, h3, h4 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            line-height: 1.2;
            color: var(--primary);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .section {
            padding: 80px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
            font-size: 2.5rem;
        }

        .btn {
            display: inline-block;
            padding: 14px 32px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background-color: var(--primary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-community {
            background-color: var(--community);
            color: white;
        }

        .btn-community:hover {
            background-color: #388E3C;
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .btn-comply {
            background-color: var(--comply);
            color: white;
        }

        .btn-comply:hover {
            background-color: #3F51B5;
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: white;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 15px 0;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary);
            text-decoration: none;
        }

        .logo i {
            margin-right: 10px;
            color: var(--accent);
        }

        nav {
            display: flex;
            align-items: center;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin: 0 15px;
        }

        .nav-links a {
            color: var(--neutral-dark);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            padding: 5px 0;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent);
            transition: var(--transition);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
        }

        .hero {
            background: linear-gradient(rgba(26, 35, 126, 0.85), rgba(26, 35, 126, 0.85)), 
                        url('https://images.unsplash.com/photo-1609840114030-9ae5c1b1b7e9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 90px 0 50px;
            text-align: center;
            position: relative;
        }
        .hero {
    margin-top: 80px; /* Adjust this value to match your header height */
}

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: white;
        }

        .hero p {
            font-size: 1.4rem;
            margin-bottom: 40px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .counter {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            display: inline-block;
            margin: 30px 0;
        }

        .counter-number {
            font-size: 3.5rem;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
        }

        .counter-label {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stats {
            background-color: var(--primary);
            color: white;
            padding: 40px 0;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .stat-card {
            text-align: center;
            padding: 25px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .stat-number {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent);
            font-family: 'Poppins', sans-serif;
        }

        /* EpiMap Section Styles */
        .epimap-section {
            background: linear-gradient(to bottom, #f9f9f9, #ffffff);
        }
        
        .epimap-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .epimap-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        .epimap-description {
            flex: 1;
            min-width: 300px;
        }
        
        .epimap-buttons {
            display: flex;
            gap: 15px;
        }
        
        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        #epimap {
            height: 100%;
            width: 100%;
        }
        
        .map-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .color-emergency {
            background: #FF5252;
        }
        
        .color-business {
            background: #5C6BC0;
        }
        
        .color-community {
            background: #4CAF50;
        }
        
        .epimap-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .epimap-stat {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .epimap-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* EpiComply Section Styles */
        .epicomply-section {
            background: linear-gradient(to bottom, var(--comply), #3F51B5);
            color: white;
        }
        
        .epicomply-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
        }
        
        .epicomply-content {
            padding: 30px;
        }
        
        .epicomply-steps {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 40px;
        }
        
        .epicomply-step {
            display: flex;
            gap: 20px;
        }
        
        .step-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .epicomply-form-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
        }
        
        .epicomply-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .compliance-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 600;
            margin: 10px 0;
            font-size: 1.1rem;
        }
        
        .badge-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }
        
        .compliance-badge-large {
            background: white;
            color: var(--comply);
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.4rem;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .mission-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        .mission-image {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            height: 450px;
            background: url('mission-epipen-photo.jpg') center/cover;
        }

        .mission-text h2 {
            margin-bottom: 20px;
            color: var(--primary);
        }

        .timeline {
            margin-top: 40px;
        }

        .timeline-item {
            position: relative;
            padding-left: 30px;
            margin-bottom: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--accent);
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: 7px;
            top: 24px;
            width: 2px;
            height: calc(100% + 10px);
            background-color: var(--accent);
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-year {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .benefits {
            background-color: var(--neutral-light);
        }

        .benefits-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .benefit-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .benefit-card:hover {
            transform: translateY(-10px);
        }

        .benefit-icon {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .benefit-title {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .quote {
            background: var(--primary);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 40px 0;
            position: relative;
        }

        .quote::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 5rem;
            font-family: serif;
            color: rgba(255, 255, 255, 0.2);
        }

        .quote-text {
            font-size: 1.3rem;
            font-style: italic;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .quote-author {
            font-weight: 500;
            text-align: right;
        }

        .legal-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .legal-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--accent);
        }

        .legal-icon {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .training {
            background: linear-gradient(to bottom, #f9f9f9, #ffffff);
        }

        .training-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        .video-container {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .quiz-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 40px;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            margin: 50px 0;
            position: relative;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 60px;
            left: 10%;
            width: 80%;
            height: 3px;
            background: var(--accent);
            z-index: 0;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 1;
            width: 30%;
        }

        .step-number {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 0 auto 20px;
        }

        .step-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .faq-item {
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .faq-question {
            background: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .faq-question i {
            transition: transform 0.3s ease;
        }

        .faq-answer {
            background: #f9f9f9;
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }

        .faq-item.active .faq-answer {
            padding: 20px;
            max-height: 500px;
        }

        .contact {
            background: linear-gradient(to bottom, var(--primary), #0d153f);
            color: white;
            text-align: center;
        }

        .contact-form {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 15px;
        }

        .contact-form .form-group {
            margin-bottom: 20px;
        }

        .contact-form .form-group label {
            display: block;
            text-align: left;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .contact-form .form-control {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }

        .equity-section {
            background: linear-gradient(to right, var(--primary), var(--community));
            color: white;
            padding: 80px 0;
            text-align: center;
        }

        .equity-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .law-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 600;
            margin: 20px 0;
            font-size: 1.1rem;
        }

        .community-partners {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 40px;
        }

        .partner-logo {
            width: 120px;
            height: 120px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        footer {
            background: #0d153f;
            color: white;
            padding: 60px 0 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--accent);
            padding-left: 5px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: var(--transition);
        }

        .social-links a:hover {
            background: var(--accent);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Responsive Design */
                @media (max-width: 992px) {
            .mission-content,
            .training-container,
            .benefits-container,
            .epicomply-container {
                grid-template-columns: 1fr;
            }
            
            .steps {
                flex-direction: column;
                gap: 30px;
            }
            
            .steps::before {
                display: none;
            }
            
            .step {
                width: 100%;
            }
            
            .hero h1 {
                font-size: 2.8rem;
            }
            
            .epimap-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .epimap-buttons {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }
            
            .nav-links {
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: white;
                flex-direction: column;
                align-items: center;
                padding: 20px 0;
                box-shadow: 0 10px 10px rgba(0,0,0,0.1);
                display: none;
                z-index: 999;
            }
            
            .nav-links.active {
                display: flex;
            }
            
            .nav-links.active {
                transform: translateY(0);
            }
            
            .nav-links li {
                margin: 15px 0;
            }
            
            .section {
                padding: 60px 0;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .hero {
                padding: 90px 0 40px;
                margin-top: 60;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero-buttons {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .hero-buttons .btn {
                width: 100%;
                text-align: center;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            header {
                background-color: white;
                border-bottom: 1px solid #e0e0e0;
            }
        }

        /* ── Allergy News section ───────────────────────────────────────── */
.news-section{
  background:#fff;
  padding:80px 0;
}
.news-title{
  text-align:center;
  font-size:2.5rem;
  margin-bottom:50px;
  color:var(--primary);
  font-family:'Poppins',sans-serif;
  font-weight:600;
}
#news-feed{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:30px;
  width:90%;
  max-width:1200px;
  margin:0 auto;
}
.news-card{
  display:grid;
  grid-template-columns:112px 1fr;
  gap:15px;
  background:#fff;
  border-radius:12px;
  box-shadow:var(--shadow);
  padding:20px;
  align-items:start;
  transition:transform .25s ease;
}
.news-card:hover{transform:translateY(-6px)}
.news-card img{
  width:112px;height:112px;object-fit:cover;border-radius:8px;
}
.news-card a{
  font-weight:600;color:var(--primary);text-decoration:none;
}
.news-card a:hover{text-decoration:underline}
.news-card time{
  font-size:.85rem;color:#666;margin-top:4px;
}
#error{
  color:#B00020;
  font-weight:600;
  margin-top:20px;
  text-align:center;
}
/* ─────────────────────────────────────────────────────────────── */
#map {
  width: 100%;
  height: 600px;
  min-height: 400px;
  min-width: 280px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
            <a href="#" class="logo">
    <img src="epiaccess-logo.png" alt="EpiAccess Logo" style="height:118px; vertical-align:middle;">
</a>
            <button class="mobile-toggle" id="mobileToggle">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="#home">Home</a></li>
                <li><a href="#epimap">EpiMap™</a></li>
                <li><a href="#epicomply">EpiComply™</a></li>
                <li><a href="#mission">Mission</a></li>
                <li><a href="#laws">Laws</a></li>
                <li><a href="#benefits">Why</a></li>
                <li><a href="#training">Training</a></li>
                <li><a href="#distribution">How It Works</a></li>
                <li><a href="#equity">Community Equity</a></li>
            </ul>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>Safety Shouldn't Be a Privilege</h1>
                <p>New York State law ensures life-saving epinephrine access for all</p>
                
                <div class="counter">
                    <div class="counter-number">1 in 20</div>
                    <div class="counter-label">people in the US rely on Epinephrine for Anaphylaxis</div>
                </div>
                
                <div class="hero-buttons">
                    <a href="#laws" class="btn btn-primary">NY Legal Requirements</a>
                    <a href="#equity" class="btn btn-community">Community Equity Program</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats">
        <div class="container stats-container">
            <div class="stat-card">
                <div class="stat-number">Only 52%</div>
                <div>of people with allergies have access to epinephrine</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">$2,400</div>
                <div>average ER bill for reactions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">85%</div>
                <div>of fatal reactions lacked EpiPens</div>
            </div>
        </div>
    </section>

    <!-- Mission Section -->
    <section class="section" id="mission">
        <div class="container">
            <h2 class="section-title">Our Mission: Put Epinephrine Within Reach</h2>
            <div class="mission-content">
                <div class="mission-image"></div>
                <div class="mission-text">EpiAccess exists to eliminate cost and access barriers that turn allergic reactions into tragedies. New York’s landmark laws make community epinephrine possible. We partner with businesses, schools, child-care centers, senior facilities, and public venues statewide to place epinephrine auto-injectors where people live, learn, work, and gather. EpiAccess.org coordinates supply, training, and compliance so lifesaving medicine is always within reach.</p>
                    
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-year">Where</div>
                            <div> Across New York, in schools, child-care centers, restaurants, senior facilities, gyms, and public venues where people live, learn, work, and gather. </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">What</div>
                            <div>A complete stock-epinephrine program that includes standing orders, pharmacy fulfillment, staff training and certification, incident review, and simple compliance.</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">How</div>
                            <div>With community partners and trained volunteers, we place epinephrine where it is needed and keep it ready. We work with clinicians and pharmacies, track expirations, and support each site year round. </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">When</div>
                            <div>From onboarding to ready to respond in days, with annual recertification and proactive reminders for expirations and replacements.</div>
                        </div>
                    </div>
                    
                    <a href="#equity" class="btn btn-community">Learn About Equity Program</a>
                </div>
            </div>
        </div>
    </section>

    <!-- NY Laws Section -->
    <section class="section" id="laws">
        <div class="container">
            <h2 class="section-title">New York State Laws Protecting You</h2>
            <div class="legal-cards">
                <div class="legal-card">
                    <div class="legal-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h3>Elijah's Law (2021)</h3>
                    <p>Requires NY childcare programs to implement allergy action plans and stock epinephrine auto-injectors.</p>
                    <a href="#" class="btn btn-primary">Read Full Legislation</a>
                </div>
                
                <div class="legal-card">
                    <div class="legal-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Good Samaritan Expansion (2024)</h3>
                    <p>Protects businesses and trained individuals from liability when administering epinephrine in good faith.</p>
                    <a href="#" class="btn btn-primary">Legal Protections</a>
                </div>
                
                <div class="legal-card">
                    <div class="legal-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3>Public Access Law § 3000-c</h3>
                    <p>Authorizes businesses to maintain epinephrine auto-injectors and permits trained employees to use them.</p>
                    <a href="#" class="btn btn-primary">Business Requirements</a>
                </div>
            </div>
            
            <div class="quote">
                <p class="quote-text">"No person shall be held liable for damages when they, in good faith, administer epinephrine to another person reasonably believed to be having an anaphylactic reaction."</p>
                <p class="quote-author">NY Public Health Law § 3000-b</p>
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="section benefits" id="benefits">
        <div class="container">
            <h2 class="section-title">Why Stock EpiPens</h2>
            <div class="benefits-container">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-hand-holding-heart"></i>
                    </div>
                    <h3 class="benefit-title">Community Responsibility</h3>
                    <p>Be part of a statewide network ensuring all New Yorkers—especially vulnerable populations—can feel safe in public spaces.</p>
                    <ul>
                        <li>Protect children from low-income families</li>
                        <li>Support customers with limited healthcare access</li>
                        <li>Demonstrate commitment to community wellbeing</li>
                    </ul>
                </div>
                
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <h3 class="benefit-title">Legal & Financial Benefits</h3>
                    <p>NY State laws provide significant protections and advantages for participating businesses.</p>
                    <ul>
                        <li>Full liability protection under Good Samaritan laws</li>
                        <li>Potential insurance premium reductions</li>
                        <li>Tax benefits for medical equipment</li>
                        <li>Enhanced community reputation</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
        <!-- EpiMap Section -->
<section class="section epimap-section" id="epimap">
  <h2 class="section-title">EpiMap™</h2>
  <p style="text-align: center; font-size: 1.2rem; margin-bottom: 30px; max-width: 800px; margin-left: auto; margin-right: auto;">
    Zoom in on the EpiMap™ below to find the locations in your area that carry Epinephrine Auto Injectors on premises
  </p>
<div id="map" style="width: 100%; height: 600px;"></div>
</section>

    <!-- EpiComply Section -->
    <section class="section epicomply-section" id="epicomply">
        <div class="container">
            <h2 class="section-title" style="color: white;">EpiComply™: Compliance for Businesses</h2>
            
            <div class="epicomply-container">
                <div class="epicomply-content">
                    <p style="font-size: 1.2rem; margin-bottom: 30px;">New York businesses: Use our EpiComply™ web app to ensure you meet state requirements and become EpiAccess certified.</p>
                    
                    <div class="compliance-badge">NY State Approved</div>
                    
                    <div class="epicomply-steps">
                        <div class="epicomply-step">
                            <div class="step-icon">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div>
                                <h3>Compliance Checklist</h3>
                                <p>Step-by-step guide to meet all NY legal requirements for epinephrine access.</p>
                            </div>
                        </div>
                        
                        <div class="epicomply-step">
                            <div class="step-icon">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <div>
                                <h3>Official Certification</h3>
                                <p>Get recognized as an EpiAccess certified business with our official badge.</p>
                            </div>
                        </div>
                        
                        <div class="epicomply-step">
                            <div class="step-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div>
                                <h3>Auto-Renewal Reminders</h3>
                                <p>Never miss a training or epinephrine expiration date with our notification system.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="badge-container">
                        <img src="epiaccess-certified-badge.png" alt="EpiAccess Certified - Epinephrine Auto-Injector" style="width: 250px; height: auto;">
                    </div>
                </div>
                
                <div class="epicomply-form-container">
                    <h3 style="margin-bottom: 30px; text-align: center;">Access EpiComply™</h3>
                    
                    <form class="epicomply-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="businessName">Business Name</label>
                                <input type="text" id="businessName" class="form-control" placeholder="Your Business">
                            </div>
                            
                            <div class="form-group">
                                <label for="businessType">Business Type</label>
                                <select id="businessType" class="form-control">
                                    <option value="">Select Type</option>
                                    <option value="restaurant">Restaurant</option>
                                    <option value="retail">Retail</option>
                                    <option value="school">School/Childcare</option>
                                    <option value="community">Community Center</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="epicomply-email" class="form-control" placeholder="contact@business.com">
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" class="form-control" placeholder="(212) 555-1234">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="address">Business Address</label>
                                <input type="text" id="address" class="form-control" placeholder="123 Main St, New York, NY">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="password">Create Password</label>
                                <input type="password" id="password" class="form-control" placeholder="Create a password">
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password</label>
                                <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm your password">
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-comply" style="width: 100%; padding: 16px; margin-top: 20px;">
                            Create EpiComply™ Account
                        </button>
                        
                        <p style="text-align: center; margin-top: 20px;">
                            Already have an account? <a href="#" style="color: white; text-decoration: underline;">Sign In</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Community Equity Section -->
    <section class="equity-section" id="equity">
        <div class="container">
            <div class="equity-content">
                <h2>Community Equity Program</h2>
                <p style="font-size: 1.3rem; margin: 30px auto; max-width: 700px;">We believe life-saving medication should never be out of reach due to economic circumstances. Contact us to see if your business qualifies for free or reduced cost Epinephrine Auto Injectors.</p>
                
                <a href="#enroll" class="btn btn-community" style="margin-top: 40px;">Contact Us</a>
            </div>
        </div>
    </section>

    <!-- Training Section -->
    <section class="section training" id="training">
        <div class="container">
            <h2 class="section-title">Accessible Training for All</h2>
            <div class="training-container">
                <div>
                    <h3>Free NYS-Compliant Certification</h3>
                    <p>Our training meets all New York State requirements and is available in 8 languages. No internet? We provide in-person training for community centers.</p>
                    <ul>
                        <li>Recognize signs of anaphylaxis</li>
                        <li>Proper EpiPen administration</li>
                        <li>NY-specific legal protocols</li>
                        <li>Documentation and reporting</li>
                    </ul>
                    <p style="margin: 20px 0;">Certification is valid for two years and meets all New York State requirements.</p>
                    <a href="#" class="btn btn-primary">Start Free Training</a>
                </div>
                
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/vki42stNqMM?start=4" title="EpiPen Training" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </section>

    <!-- Distribution Section -->
    <section class="section" id="distribution">
        <div class="container">
            <h2 class="section-title">How EpiAccess Works in NY</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Enroll</h3>
                        <p>Complete our simple enrollment - special programs for underserved communities</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Train</h3>
                        <p>Complete free NYS-compliant training in-person or online</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Protect</h3>
                        <p>Receive epinephrine auto-injectors with free replacements</p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <a href="#enroll" class="btn btn-primary">Enroll Your Business</a>
                <a href="#equity" class="btn btn-community" style="margin-left: 15px;">Equity Program Info</a>
            </div>
        </div>
    </section>
    <!-- ===== Latest Allergy News ===== -->
<section class="news-section" id="news">
  <h2 class="news-title">Latest Allergy News</h2>
  <div id="news-feed"></div>
  <div id="error"></div>
</section>


    <!-- FAQ Section -->
    <section class="section" id="faq">
        <div class="container">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <span>How does this help low-income communities?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Our Community Equity Program provides free epinephrine auto-injectors to public spaces in underserved neighborhoods and offers sliding scale fees for small businesses. We prioritize areas with limited healthcare access.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>What does NY law require of businesses?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>While not mandatory, NY law (Public Health Law § 3000-c) explicitly permits businesses to stock and administer epinephrine. The law provides liability protection through Good Samaritan provisions when businesses follow proper protocols.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>How can community centers participate?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Community centers, libraries, and public housing facilities qualify for our free program including equipment, training, and support. Contact us to enroll your community space.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="section contact" id="enroll">
        <div class="container">
            <h2 class="section-title" style="color: white;">Enroll Your NY Business</h2>
            <div class="contact-form">
                <h3 style="margin-bottom: 30px; color: white;">Join Our Safety Network</h3>
                <form>
                    <div class="form-group">
                        <label for="name" style="color: white;">Your Name</label>
                        <input type="text" id="name" class="form-control" placeholder="John Smith">
                    </div>
                    
                    <div class="form-group">
                        <label for="email" style="color: white;">Email</label>
                        <input type="email" id="enroll-email" class="form-control" placeholder="john@restaurant.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="business" style="color: white;">Business Name</label>
                        <input type="text" id="business" class="form-control" placeholder="Smith's Restaurant">
                    </div>
                    
                    <div class="form-group">
                        <label for="zip" style="color: white;">ZIP Code</label>
                        <input type="text" id="zip" class="form-control" placeholder="10453">
                    </div>
                    
                    <div class="form-group">
                        <label for="description" style="color: white;">Description of Your Business</label>
                        <textarea id="description" class="form-control" rows="4" placeholder="Please describe your business, including type of services, typical customer base, and any other relevant information"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-community" style="width: 100%; padding: 16px; font-size: 1.1rem;">Submit Enrollment</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>EpiAccess NY</h3>
                    <p>Ensuring equitable access to life-saving epinephrine across New York State</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>NY State Resources</h3>
                    <ul class="footer-links">
                        <li><a href="#">Elijah's Law (S. 4344B)</a></li>
                        <li><a href="#">Good Samaritan Law</a></li>
                        <li><a href="#">Public Health Law § 3000-c</a></li>
                        <li><a href="#">DOH Epinephrine Guidance</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Community Programs</h3>
                    <ul class="footer-links">
                        <li><a href="#">Equity Program Application</a></li>
                        <li><a href="#">Free Community Training</a></li>
                        <li><a href="#">Public Space Initiative</a></li>
                        <li><a href="#">Partner With Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt"></i> 60 Plant Ave, Hauppauge NY,11788</li>
                        <li><i class="fas fa-envelope"></i> info@epiaccess.org</li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 EpiAccess New York. All rights reserved. | Nonprofit organization 501(c)(3)</p>
                <p style="margin-top: 10px;">Proudly serving all 62 counties of New York State</p>
            </div>
        </div>
    </footer>
<script>
// Initialize EmailJS with your public key
(function() {
    emailjs.init("4leFj0m4jT7WPX7Nw");
})();

document.addEventListener('DOMContentLoaded', function () {
    // Mobile Menu Toggle
    const mobileToggle = document.getElementById('mobileToggle');
    const navLinks = document.getElementById('navLinks');
    if (mobileToggle && navLinks) {
        mobileToggle.addEventListener('click', function () {
            navLinks.classList.toggle('active');
        });
    }

    // FAQ Accordion
    document.querySelectorAll('.faq-item').forEach(item => {
        const question = item.querySelector('.faq-question');
        question.addEventListener('click', () => {
            item.classList.toggle('active');
        });
    });

    // Smooth Scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                e.preventDefault();
                window.scrollTo({
                    top: target.offsetTop - 80,
                    behavior: 'smooth'
                });
                // Close mobile menu if open
                navLinks.classList.remove('active');
            }
        });
    });

    // Community buttons
    document.querySelectorAll('.btn-community').forEach(btn => {
        btn.addEventListener('click', function (e) {
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                e.preventDefault();
                window.scrollTo({
                    top: target.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // EpiComply form submission
    const epicomplyForm = document.querySelector('.epicomply-form');
    if (epicomplyForm) {
        epicomplyForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Get form values
            const formData = {
                businessName: document.getElementById('businessName').value,
                businessType: document.getElementById('businessType').value,
                email: document.getElementById('epicomply-email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                formType: 'EpiComply Registration'
            };
            
            // Send email using EmailJS
            emailjs.send('service_waagqdp', 'template_6e6pof8', {
                to_email: 'epiaccess.org@gmail.com',
                from_name: formData.businessName,
                from_email: formData.email,
                subject: 'New EpiComply Registration',
                message: `
                    Form Type: ${formData.formType}
                    Business Name: ${formData.businessName}
                    Business Type: ${formData.businessType}
                    Email: ${formData.email}
                    Phone: ${formData.phone}
                    Address: ${formData.address}
                `
            }).then(function() {
                alert('Thank you for registering for EpiComply™! You will receive an email with login instructions shortly.');
                epicomplyForm.reset();
            }, function(error) {
                alert('There was an error submitting your registration. Please try again or contact us directly.');
                console.error('EmailJS error:', error);
            });
        });
    }
    
    // Enrollment form submission
    const enrollmentForm = document.querySelector('#enroll form');
    if (enrollmentForm) {
        enrollmentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Get form values
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('enroll-email').value,
                businessName: document.getElementById('business').value,
                zip: document.getElementById('zip').value,
                description: document.getElementById('description').value,
                formType: 'Business Enrollment'
            };
            
            // Send email using EmailJS
            emailjs.send('service_waagqdp', 'template_6e6pof8', {
                to_email: 'epiaccess.org@gmail.com',
                from_name: formData.name,
                from_email: formData.email,
                subject: 'New Business Enrollment',
                message: `
                    Form Type: ${formData.formType}
                    Name: ${formData.name}
                    Email: ${formData.email}
                    Business Name: ${formData.businessName}
                    ZIP Code: ${formData.zip}
                    Business Description: ${formData.description}
                `
            }).then(function() {
                alert('Thank you for enrolling! We will contact you shortly with more information.');
                enrollmentForm.reset();
            }, function(error) {
                alert('There was an error submitting your enrollment. Please try again or contact us directly.');
                console.error('EmailJS error:', error);
            });
        });
    }
});
</script> <!-- END of your custom JS block -->


<script>
function initMap() {
    var center = { lat: 40.7128, lng: -74.0060 };
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: center
    });

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var userLoc = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            map.setCenter(userLoc);
            new google.maps.Marker({
                position: userLoc,
                map: map,
                title: "You are here"
            });
        });
    }
}
</script>
    <!-- RSS merge + thumbnails -->
<script defer>
var RSS_KEY='rbkj47ti9hvvg1cde8u1ztm1xqhmwppufbeeexcq';                          // <— put your key
var FEEDS=[
 'https://www.fda.gov/about-fda/contact-fda/stay-informed/rss-feeds/food-allergies/rss.xml',
 'https://www.fda.gov/about-fda/contact-fda/stay-informed/rss-feeds/food-safety-recalls/rss.xml',
 'https://www.sciencedaily.com/rss/health_medicine/allergy.xml',
 'https://news.google.com/rss/search?q=allergy+OR+food+allergy&hl=en-US&gl=US&ceid=US:en'
];
var PLACE='https://placehold.co/112x112?text=EPI',MAX=18;
function rss(u){return 'https://api.rss2json.com/v1/api.json?api_key='+RSS_KEY+'&count=20&images=true&rss_url='+encodeURIComponent(u);}
function microlink(u){return 'https://api.microlink.io/?meta=true&audio=false&video=false&url='+encodeURIComponent(u);}
function fix(u){if(!u)return'';if(u.slice(0,2)==='//')return'https:'+u;if(u.slice(0,7)==='http://')return'https://'+u.substr(7);return u;}
function imgFrom(it){
  if(it.thumbnail) return fix(it.thumbnail);
  if(it.enclosure&&it.enclosure.link) return fix(it.enclosure.link);
  if(it.enclosure&&it.enclosure.url)  return fix(it.enclosure.url);
  if(it['media:thumbnail']&&it['media:thumbnail'].url) return fix(it['media:thumbnail'].url);
  if(it['media:content']&&it['media:content'].url)     return fix(it['media:content'].url);
  var h=(it.content||it.description||''),m=h.match(/<img[^>]+(?:src|data-src)=['"]([^'"]+)['"]/i);
  return m?fix(m[1]):'';
}
function unwrap(u){return(u.indexOf('news.google.com')>-1&&u.indexOf('url=')>-1)?decodeURIComponent(u.split('url=')[1].split('&')[0]):u;}

(function(){
  Promise.allSettled(FEEDS.map(function(f){return fetch(rss(f)).then(function(r){return r.json();});}))
  .then(function(arr){
    var items=[];arr.forEach(function(r){if(r.status==='fulfilled'&&r.value&&r.value.status==='ok')items=items.concat(r.value.items||[]);});
    if(!items.length){document.getElementById('error').textContent='News feed unavailable.';return;}
    items.sort(function(a,b){return new Date(b.pubDate)-new Date(a.pubDate);});
    render(items.slice(0,MAX));
  }).catch(function(){document.getElementById('error').textContent='News feed error.';});
})();

function render(list){
  var box=document.getElementById('news-feed');
  list.forEach(function(it){
    var img=imgFrom(it),card=document.createElement('div');
    card.className='news-card';
    card.innerHTML='<img src="'+(img||PLACE)+'" alt=""><div><a href="'+it.link+'" target="_blank" rel="noopener">'+it.title+'</a><time datetime="'+it.pubDate+'">'+new Date(it.pubDate).toLocaleDateString()+'</time></div>';
    box.appendChild(card);
    if(!img){(function(n,u){
      fetch(microlink(u)).then(function(r){return r.json();}).then(function(d){
        if(d.status==='success'&&d.data&&d.data.image&&d.data.image.url)
          n.querySelector('img').src=fix(d.data.image.url);
      })["catch"](function(){});
    })(card,unwrap(it.link));}
  });
}
</script>
<!-- Firebase JS SDKs (v8.x for compatibility with your code) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- EpiMap App Logic (add this block before </body>) -->
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAEqp-BO5SGdoKEB154FfgVsRP0cdaxpAU",
  authDomain: "epipen-finder-map-34982.firebaseapp.com",
  projectId: "epipen-finder-map-34982",
  storageBucket: "epipen-finder-map-34982.appspot.com",
  messagingSenderId: "389714610819",
  appId: "1:389714610819:web:a1a6310b98039d9ab2e9b6",
  measurementId: "G-KZ5PPMNKEQ"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
auth.signInAnonymously().catch(console.error);

const iconDefault = "epipen_icon_transparent_32x32.png"; // replace with your PNG path if needed
const iconVerified = "data:image/svg+xml;base64," + btoa(`
  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <rect x="6" y="12" width="20" height="8" rx="4" fill="#4caf50" stroke="#333" stroke-width="1"/>
    <rect x="8" y="14" width="16" height="4" rx="2" fill="#8bc34a"/>
    <text x="16" y="18" text-anchor="middle" fill="#fff" font-size="8" font-family="Arial">EPI</text>
    <circle cx="24" cy="16" r="2" fill="#2e7d32"/>
    <path d="M22 14 l2 2 l4-4" stroke="#fff" stroke-width="1.5" fill="none"/>
  </svg>
`);

function createMarker(map, data, docId, likes = 0, flags = 0) {
  const marker = new google.maps.Marker({
    position: { lat: data.lat, lng: data.lng },
    map,
    title: data.name,
    icon: {
      url: data.verifiedByBusiness ? iconVerified : iconDefault,
      scaledSize: new google.maps.Size(32, 32)
    }
  });

  const infoWindow = new google.maps.InfoWindow({
    content: `
      <div style="max-width: 300px;">
        <strong>${data.name}</strong><br>
        ${data.address}<br>
        Type: ${data.type}<br>
        ${data.verifiedByBusiness ? "<span style='color:green'>✅ Verified by the business</span><br>" : ""}
        <button onclick="submitFeedback('${docId}', 'like')">👍 Confirm</button>
        <button onclick="submitFeedback('${docId}', 'flag')">🚩 Flag</button><br>
        👍 ${likes} | 🚩 ${flags}<br><br>
        ${!data.verifiedByBusiness ? `<a href='mailto:verify@epipenmap.org?subject=Verify My EpiPen Location&body=Name: ${encodeURIComponent(data.name)}%0D%0AAddress: ${encodeURIComponent(data.address)}'>Request to Verify</a>` : ""}
      </div>
    `
  });

  marker.addListener("click", () => infoWindow.open(map, marker));
  return marker;
}

window.initMap = async function () {
  let mapCenter = { lat: 39.8283, lng: -98.5795 };
  let zoomLevel = 5;

  if (navigator.geolocation) {
    try {
      const position = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 8000 });
      });
      mapCenter = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      zoomLevel = 13;
    } catch (err) {
      console.warn("Geolocation not available or denied, using default center.");
    }
  }

  const map = new google.maps.Map(document.getElementById("map"), {
    center: mapCenter,
    zoom: zoomLevel,
    gestureHandling: "greedy"
  });

  // Load existing markers from database
  const snapshot = await db.collection("locations").get();
  for (const doc of snapshot.docs) {
    const data = doc.data();
    const feedbackSnap = await db.collection("locations").doc(doc.id).collection("feedback").get();
    let likes = 0, flags = 0;
    feedbackSnap.forEach(f => {
      if (f.data().type === "like") likes++;
      if (f.data().type === "flag") flags++;
    });
    createMarker(map, data, doc.id, likes, flags);
  }

  map.addListener("click", async function (event) {
    const clickedLatLng = event.latLng;
    const confirmTag = window.confirm("Tag this location as having an EpiPen?");
    if (!confirmTag) return;

    try {
      // Replace the API key here with your own
      const geocode = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${clickedLatLng.lat()},${clickedLatLng.lng()}&key=AIzaSyCcYxF0mxiJIO7r2wPHwUBEcd9fSC_-HJ0`);
      const data = await geocode.json();

      if (!data.results || data.results.length === 0) {
        alert("Could not identify this location.");
        return;
      }

      const result = data.results[0];
      const addressParts = result.formatted_address.split(',');
      let locationName = addressParts[0].trim();

      if (locationName.match(/^\d+/)) {
        const customName = prompt(`Enter a name for this location:\n(e.g., "CVS Pharmacy", "Community Center")`);
        if (customName && customName.trim()) {
          locationName = customName.trim();
        }
      }

      const locationData = {
        name: locationName,
        type: "community-tagged",
        address: result.formatted_address,
        lat: clickedLatLng.lat(),
        lng: clickedLatLng.lng(),
        submittedAt: new Date(),
        verifiedByBusiness: false
      };

      const docRef = await db.collection("locations").add(locationData);
      createMarker(map, locationData, docRef.id, 0, 0);

      // Show success message
      const confirmation = document.createElement("div");
      confirmation.textContent = `✅ "${locationName}" tagged successfully!`;
      confirmation.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background: #4caf50;
        color: white;
        border-radius: 6px;
        font-weight: bold;
        z-index: 9999;
        font-family: Arial, sans-serif;
      `;
      document.body.appendChild(confirmation);
      setTimeout(() => confirmation.remove(), 3000);

    } catch (error) {
      console.error("Error tagging location:", error);
      alert("Error tagging location. Please try again.");
    }
  });
};

window.submitFeedback = function (locationId, type) {
  db.collection("locations").doc(locationId).collection("feedback").add({
    type,
    submittedAt: new Date()
  }).then(() => {
    alert(type === "like" ? "Thanks for confirming!" : "Flag received. We'll review it.");
  }).catch(error => {
    console.error("Error submitting feedback:", error);
    alert("Error submitting feedback.");
  });
};
</script>

<!-- Google Maps API must be LAST -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcYxF0mxiJIO7r2wPHwUBEcd9fSC_-HJ0&callback=initMap" async defer></script>
</body>
</html>
